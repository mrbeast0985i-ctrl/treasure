<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="utf-8">
    <title data-i18n="ykc_verification_title">Verificaci&#243;n YKC</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="icon" href="logo.jpg" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="https://unpkg.com/i18next@21.6.14/dist/umd/i18next.min.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
        body{background:#000;color:#fff;display:flex;justify-content:center;align-items:center;min-height:100vh;overflow-x:hidden;}
        .container{display:flex;width:100%;max-width:1200px;height:95vh;background:#1e293b;border-radius:12px;box-shadow:0 0 20px rgba(0,255,255,.1);position:relative;margin:10px 0;}
        .sidebar{width:250px;background:#111827;padding:20px;display:flex;flex-direction:column;transition:transform .3s ease-in-out;}
        .sidebar nav ul{list-style:none;}
        .sidebar nav ul li{padding:15px 10px;border-radius:8px;margin-bottom:10px;cursor:pointer;transition:background .3s;}
        .sidebar nav ul li.active a,.sidebar nav ul li:hover a{background:#00ffff;padding:18px;border-radius:15px;color:#000;text-decoration:none;}
        .sidebar nav ul li a{display:flex;align-items:center;color:inherit;text-decoration:none;width:100%;}
        .sidebar nav ul li .icon{margin-right:10px;font-size:18px;}
        .main-content{flex-grow:1;padding:30px 40px;overflow-y:auto;position:relative;}
        .hamburger{display:none;position:absolute;top:20px;left:20px;background:none;border:none;color:#00ffff;font-size:24px;cursor:pointer;z-index:1000;}
        .ykc-verification-content{max-width:600px;margin:0 auto;background:#111827;padding:30px;border-radius:12px;box-shadow:0 0 20px rgba(0,255,255,.1);}
        .ykc-verification-content h2{color:#00ffff;text-align:center;margin-bottom:20px;}
        .ykc-verification-content label{display:block;margin-bottom:8px;font-weight:600;}
        .ykc-verification-content input,
        .ykc-verification-content select{width:100%;padding:12px;margin-bottom:20px;background:#1e293b;border:1px solid #2d3748;border-radius:8px;color:#fff;font-size:16px;}
        .ykc-verification-content button{width:100%;padding:12px;background:#00ffff;color:#000;border:none;border-radius:8px;font-weight:600;cursor:pointer;}
        .ykc-verification-content button:hover{background:#00e5e5;}
        .field-group{position:relative;margin-bottom:20px;}
        .field-group .check{position:absolute;right:10px;top:50%;transform:translateY(-50%);color:#00ff00;font-size:18px;display:none;}
        .field-group.approved .check{display:block;}
        .field-group.approved input,
        .field-group.approved select{background:#1a3a1a;border-color:#00ff00;color:#fff;pointer-events:none;}
        .status-msg{margin-top:20px;text-align:center;font-weight:600;}
        .status-approved{color:#00ff00;}
        .status-pending{color:#ffcc00;}
        .status-rejected{color:#ff4d4d;}

        /* Upload Container */
        .upload-container {
            background: #1e293b;
            padding: 16px;
            border-radius: 12px;
            border: 1px dashed #2d3748;
            text-align: center;
            margin-bottom: 20px;
            transition: border 0.3s;
            cursor: pointer;
        }
        .upload-container:hover {
            border-color: #00ffff;
        }
        .upload-container input[type="file"] {
            display: none;
        }
        .upload-container label {
            color: #00ffff;
            font-weight: 600;
            display: block;
            padding: 10px;
        }
        .upload-container .file-name {
            margin-top: 8px;
            font-size: 14px;
            color: #aaa;
        }

        @media (max-width:768px){
            .container{flex-direction:column;height:auto;}
            .sidebar{position:fixed;top:0;left:0;height:100%;transform:translateX(-100%);z-index:999;}
            .sidebar.show{transform:translateX(0);}
            .hamburger{display:block;}
        }
    </style>
</head>
<body>
<div class="container" id="main-container" style="display:none;">
    <button class="hamburger"><i class="fa-solid fa-bars"></i></button>

    <div class="sidebar" id="sidebar">
        <nav>
            <ul>
                <li><a href="dashboard(es).html"><i class="fa-solid fa-house icon"></i><span data-i18n="home">Inicio</span></a></li>
                <li class="active"><a href="ykc(es).html"><i class="fa-solid fa-user icon"></i><span data-i18n="YKC">YKC</span></a></li>
                <li><a href="investment(es).html"><i class="fa-solid fa-boxes-stacked icon"></i><span data-i18n="packages">Paquetes</span></a></li>
                <li><a href="deposit(es).html"><i class="fa-regular fa-credit-card icon"></i><span data-i18n="deposit">Depositar</span></a></li>
                <li><a href="withdraw(es).html"><i class="fa-regular fa-briefcase icon"></i><span data-i18n="withdraw">Retirar</span></a></li>
                <li><a href="profile(es).html"><i class="fa-regular fa-address-card icon"></i><span data-i18n="profile">Perfil</span></a></li>
                <li><a href="#" id="logout-link"><i class="fa-solid fa-right-from-bracket icon"></i><span data-i18n="logout">Cerrar sesi&#243;n</span></a></li>
            </ul>
        </nav>
        
    </div>

    <main class="ykc-verification-content">
        <!-- This form will be hidden when approved -->
        <form id="ykcForm">
            <h2 data-i18n="ykc_verification">Verificaci&#243;n YKC</h2>

            <div class="field-group" id="group-name">
                <label for="full-name" data-i18n="full_name">Nombre y apellidos</label>
                <input type="text" id="full-name" required="">
                <i class="fa-solid fa-check check"></i>
            </div>

            <div class="field-group" id="group-dob">
                <label for="date-of-birth" data-i18n="date_of_birth">Fecha de nacimiento</label>
                <input type="date" id="date-of-birth" required="">
                <i class="fa-solid fa-check check"></i>
            </div>

            <div class="field-group" id="group-address">
                <label for="address" data-i18n="address">Direcci&#243;n</label>
                <input type="text" id="address" required="">
                <i class="fa-solid fa-check check"></i>
            </div>

            <div class="field-group" id="group-idtype">
                <label for="id-type" data-i18n="id_type">Tipo de ID</label>
                <select id="id-type" required="">
                    <option value="" disabled="" selected="">Seleccione el tipo de documento</option>
                    <option value="passport">Pasaporte</option>
                    <option value="driver_license">Permiso de conducir</option>
                    <option value="national_id">Documento nacional de identidad</option>
                </select>
                <i class="fa-solid fa-check check"></i>
            </div>

            <!-- REAL UPLOAD WITH CLOUDINARY -->
            <div class="field-group" id="group-document">
                <label data-i18n="id_document">Cargar documento de identidad</label>
                <div class="upload-container">
                    <input type="file" id="id-document" accept="image/*,application/pdf" required="">
                    <label for="id-document"> <i class="fa-solid fa-cloud-upload-alt" style="font-size:20px;margin-right:8px;"></i> Haga clic para cargar el DNI </label>
                    <div class="file-name" id="file-name">No se ha seleccionado ning&#250;n archivo</div>
                </div>
                <i class="fa-solid fa-check check"></i>
            </div>

            <button type="submit" data-i18n="submit_verification">Enviar verificaci&#243;n</button>
        </form>

        <!-- Status message -->
        <div class="status-msg" id="statusMsg"></div>
    </main>
</div>

<script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js';
    import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js';
    import { getFirestore, collection, addDoc, query, where, onSnapshot, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js';

     const firebaseConfig = {
      apiKey: "AIzaSyCDfyVAhNfuXYyzeetQ1_wlFhz7-wXWHDk",
      authDomain: "treasure-f5cc7.firebaseapp.com",
      projectId: "treasure-f5cc7",
      storageBucket: "treasure-f5cc7.firebasestorage.app",
      messagingSenderId: "726318121382",
      appId: "1:726318121382:web:3cf5c5c7e628c9e313cf67",
      measurementId: "G-E3MBP4PH90"
    };

    const auth = getAuth(app);
    const db   = getFirestore(app);
    let currentUser = null;

    const CLOUDINARY_CLOUD_NAME = 'dredyfvhv';
    const CLOUDINARY_UPLOAD_PRESET = 'deposit_proofs'; // SAME AS DEPOSIT

    /* ---------- i18n ---------- */
   
    /* ---------- File Name Display ---------- */
    document.getElementById('id-document').addEventListener('change', function() {
        const fileName = this.files[0]?.name || 'No file chosen';
        document.getElementById('file-name').textContent = fileName;
    });

    /* ---------- Sidebar ---------- */
    document.querySelector('.hamburger').onclick = () => document.getElementById('sidebar').classList.toggle('show');

    /* ---------- Auth ---------- */
    onAuthStateChanged(auth, user => {
        if (!user) return location.href = 'login.html';
        currentUser = user;
        document.getElementById('main-container').style.display = 'flex';
        loadUserVerification();
    });

    /* ---------- Load & Show Approved State ---------- */
    function loadUserVerification() {
        const q = query(collection(db, 'ykc_verifications'), where('uid', '==', currentUser.uid));
        onSnapshot(q, snap => {
            const form = document.getElementById('ykcForm');
            const statusMsg = document.getElementById('statusMsg');

            if (snap.empty) {
                form.style.display = 'block';
                statusMsg.textContent = '';
                return;
            }

            const data = snap.docs[0].data();
            const status = data.status || 'pending';

            statusMsg.textContent = i18next.t(`status_${status}`);
            statusMsg.className = `status-msg status-${status}`;

            if (status === 'approved') {
                // Fill fields
                document.getElementById('full-name').value = data.fullName || '';
                document.getElementById('date-of-birth').value = data.dob || '';
                document.getElementById('address').value = data.address || '';
                document.getElementById('id-type').value = data.idType || '';

                // Mark all approved
                ['name', 'dob', 'address', 'idtype', 'document'].forEach(id => {
                    const group = document.getElementById(`group-${id}`);
                    if (group) group.classList.add('approved');
                });

                form.style.display = 'none';
            } else {
                form.style.display = 'block';
            }
        });
    }

    /* ---------- Submit WITH CLOUDINARY ---------- */
    document.getElementById('ykcForm').onsubmit = async e => {
        e.preventDefault();

        const fileInput = document.getElementById('id-document');
        const file = fileInput.files[0];
        const statusMsg = document.getElementById('statusMsg');

        if (!file) {
            statusMsg.textContent = 'Please upload ID document';
            statusMsg.style.color = '#ff4444';
            return;
        }

        statusMsg.textContent = i18next.t('uploading');
        statusMsg.style.color = '#00ffff';

        try {
            // Upload to Cloudinary
            const formData = new FormData();
            formData.append('file', file);
            formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);

            const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/upload`, {
                method: 'POST',
                body: formData
            });
            const data = await res.json();

            if (!data.secure_url) throw new Error('Upload failed');

            // Save to Firestore
            await addDoc(collection(db, 'ykc_verifications'), {
                uid: currentUser.uid,
                fullName: document.getElementById('full-name').value.trim(),
                dob: document.getElementById('date-of-birth').value,
                address: document.getElementById('address').value.trim(),
                idType: document.getElementById('id-type').value,
                documentURL: data.secure_url,
                status: 'pending',
                submittedAt: serverTimestamp()
            });

            statusMsg.textContent = 'Submitted! Awaiting approval.';
            statusMsg.style.color = '#00ff00';
            e.target.reset();
            document.getElementById('file-name').textContent = 'No file chosen';
        } catch (err) {
            console.error(err);
            statusMsg.textContent = i18next.t('upload_failed');
            statusMsg.style.color = '#ff4444';
        }
    };

    /* ---------- Logout ---------- */
    document.getElementById('logout-link').onclick = e => {
        e.preventDefault();
        signOut(auth).then(() => location.href = 'index(es).html');
    };
</script>
 <!-- Smartsupp Live Chat script -->
<!-- Smartsupp Live Chat script -->
<!-- Smartsupp Live Chat script -->
<script type="text/javascript">
var _smartsupp = _smartsupp || {};
_smartsupp.key = '3b7fcbb9b10ae9e82da06340230122bc80fdfb11';
window.smartsupp||(function(d) {
  var s,c,o=smartsupp=function(){ o._.push(arguments)};o._=[];
  s=d.getElementsByTagName('script')[0];c=d.createElement('script');
  c.type='text/javascript';c.charset='utf-8';c.async=true;
  c.src='https://www.smartsuppchat.com/loader.js?';s.parentNode.insertBefore(c,s);
})(document);
</script>
<noscript> Powered by <a href=“https://www.smartsupp.com” target=“_blank”>Smartsupp</a></noscript>
<noscript> Powered by <a href=“https://www.smartsupp.com” target=“_blank”>Smartsupp</a></noscript>
</body>
</html>